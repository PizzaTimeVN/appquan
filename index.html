<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω Pizza</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            margin-bottom: 30px;
            color: #d32f2f;
            text-align: center;
            font-size: 28px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #d32f2f;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: #d32f2f;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #b71c1c;
        }

        .btn-secondary {
            background: #757575;
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background: #616161;
        }

        .header {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-info {
            flex: 1;
        }

        .header-info h3 {
            color: #d32f2f;
            margin-bottom: 5px;
        }

        .header-info p {
            color: #666;
            font-size: 14px;
        }

        .main-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .tabs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .tab-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }

        .tab-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.12);
        }

        .tab-card h3 {
            color: #d32f2f;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .tab-card p {
            color: #666;
            font-size: 14px;
        }

        .content-section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            display: none;
        }

        .content-section.active {
            display: block;
        }

        .section-title {
            color: #d32f2f;
            font-size: 24px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .revenue-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .revenue-item label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .revenue-item input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
        }

        .category-list {
            display: grid;
            gap: 15px;
        }

        .category-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .category-header {
            background: #f5f5f5;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-header:hover {
            background: #eeeeee;
        }

        .category-content {
            display: none;
            padding: 15px;
        }

        .category-content.active {
            display: block;
        }

        .item-input {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .item-input:last-child {
            border-bottom: none;
        }

        .item-input label {
            flex: 1;
            font-weight: 500;
        }

        .item-input input {
            width: 100px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
        }

        .order-list {
            display: grid;
            gap: 15px;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .order-item.low-stock {
            border-color: #d32f2f;
            background: #ffebee;
        }

        .order-item-name {
            flex: 1;
            font-weight: 500;
        }

        .order-item-stock {
            margin: 0 20px;
            padding: 8px 16px;
            background: #f5f5f5;
            border-radius: 6px;
            font-weight: 600;
        }

        .order-item.low-stock .order-item-stock {
            background: #d32f2f;
            color: white;
        }

        .order-item input {
            width: 100px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
        }

        .check-pizza-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .check-pizza-grid {
                grid-template-columns: 1fr;
            }
        }

        .check-input-section, .check-result-section {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .check-input-section h4, .check-result-section h4 {
            margin-bottom: 20px;
            color: #d32f2f;
        }

        .pizza-size-group {
            margin-bottom: 20px;
        }

        .pizza-size-group h5 {
            margin-bottom: 15px;
            color: #555;
        }

        .pizza-input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .pizza-input-row label {
            flex: 1;
        }

        .pizza-input-row input {
            width: 100px;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            text-align: center;
        }

        .result-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .result-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }

        .result-message.error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #d32f2f;
        }

        .shortage-list {
            margin-top: 15px;
        }

        .shortage-item {
            padding: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .hidden {
            display: none;
        }

        .back-btn {
            background: #757575;
            display: inline-block;
            padding: 10px 20px;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            background: #616161;
        }

        .save-btn {
            margin-top: 20px;
        }

        .arrow {
            transition: transform 0.3s;
        }

        .category-item.active .arrow {
            transform: rotate(180deg);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h2>üçï Qu·∫£n L√Ω Pizza</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Ch·ªçn Qu√°n</label>
                    <select id="storeSelect" required>
                        <option value="">-- Ch·ªçn qu√°n --</option>
                        <option value="DH">DH</option>
                        <option value="NH">NH</option>
                        <option value="HXH">HXH</option>
                        <option value="PY">PY</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>T√™n ƒêƒÉng Nh·∫≠p</label>
                    <input type="text" id="username" required placeholder="Nh·∫≠p t√™n ƒëƒÉng nh·∫≠p">
                </div>
                <div class="form-group">
                    <label>M·∫≠t Kh·∫©u</label>
                    <input type="password" id="password" required placeholder="Nh·∫≠p m·∫≠t kh·∫©u">
                </div>
                <button type="submit" class="btn">ƒêƒÉng Nh·∫≠p</button>
            </form>
        </div>
    </div>

    <!-- Main App Screen -->
    <div id="appScreen" class="hidden">
        <div class="header">
            <div class="header-info">
                <h3 id="storeName"></h3>
                <p id="userInfo"></p>
            </div>
            <button class="btn btn-secondary" onclick="logout()" style="width: auto; padding: 10px 30px;">ƒêƒÉng Xu·∫•t</button>
        </div>

        <!-- Main Menu -->
        <div id="mainMenu" class="main-content">
            <div class="tabs">
                <div class="tab-card" onclick="showSection('revenue')">
                    <h3>üí∞ Nh·∫≠p Doanh Thu</h3>
                    <p>Ti·ªÅn m·∫∑t, chuy·ªÉn kho·∫£n, Grab, Shopee</p>
                </div>
                <div class="tab-card" onclick="showSection('inventory')">
                    <h3>üì¶ Ki·ªÉm H√†ng</h3>
                    <p>Ki·ªÉm tra t·ªìn kho theo danh m·ª•c</p>
                </div>
                <div class="tab-card" onclick="showSection('order')">
                    <h3>üõí ƒê·∫∑t H√†ng</h3>
                    <p>ƒê·∫∑t h√†ng giao t·ª´ x∆∞·ªüng</p>
                </div>
                <div class="tab-card" onclick="showSection('checkPizza')">
                    <h3>‚úÖ Check B√°nh</h3>
                    <p>Ki·ªÉm tra s·ªë l∆∞·ª£ng b√°nh</p>
                </div>
            </div>
        </div>

        <!-- Revenue Section -->
        <div id="revenueSection" class="main-content content-section">
            <button class="btn back-btn" onclick="showMainMenu()">‚Üê Quay L·∫°i</button>
            <h2 class="section-title">Nh·∫≠p Doanh Thu</h2>
            <div class="revenue-grid">
                <div class="revenue-item">
                    <label>üíµ Ti·ªÅn M·∫∑t (VNƒê)</label>
                    <input type="text" id="cashRevenue" placeholder="0" min="0">
                </div>
                <div class="revenue-item">
                    <label>üè¶ Chuy·ªÉn Kho·∫£n (VNƒê)</label>
                    <input type="text" id="transferRevenue" placeholder="0" min="0">
                </div>
                <div class="revenue-item">
                    <label>üöó Grab (VNƒê)</label>
                    <input type="text" id="grabRevenue" placeholder="0" min="0">
                </div>
                <div class="revenue-item">
                    <label>üõçÔ∏è Shopee (VNƒê)</label>
                    <input type="text" id="shopeeRevenue" placeholder="0" min="0">
                </div>
            </div>
            <button class="btn save-btn" onclick="saveRevenue()">L∆∞u Doanh Thu</button>
        </div>

        <!-- Inventory Section -->
        <div id="inventorySection" class="main-content content-section">
            <button class="btn back-btn" onclick="showMainMenu()">‚Üê Quay L·∫°i</button>
            <h2 class="section-title">Ki·ªÉm H√†ng T·ªìn Kho</h2>
            <div id="inventoryList" class="category-list"></div>
            <button class="btn save-btn" onclick="saveInventory()">L∆∞u Ki·ªÉm H√†ng</button>
        </div>

        <!-- Order Section -->
        <div id="orderSection" class="main-content content-section">
            <button class="btn back-btn" onclick="showMainMenu()">‚Üê Quay L·∫°i</button>
            <h2 class="section-title">ƒê·∫∑t H√†ng T·ª´ X∆∞·ªüng</h2>
            <div id="orderList" class="order-list"></div>
            <button class="btn save-btn" onclick="saveOrder()">G·ª≠i ƒê∆°n ƒê·∫∑t H√†ng</button>
        </div>

        <!-- Check Pizza Section -->
        <div id="checkPizzaSection" class="main-content content-section">
            <button class="btn back-btn" onclick="showMainMenu()">‚Üê Quay L·∫°i</button>
            <h2 class="section-title">Check B√°nh</h2>
            <div class="check-pizza-grid">
                <div class="check-input-section">
                    <h4>Nh·∫≠p S·ªë L∆∞·ª£ng B√°nh</h4>
                    <div class="pizza-size-group">
                        <h5>Size L</h5>
                        <div class="pizza-input-row">
                            <label>Trong m√°y t√≠nh ti·ªÅn:</label>
                            <input type="number" id="pizzaL_system" min="0" value="0">
                        </div>
                        <div class="pizza-input-row">
                            <label>S·ªë l∆∞·ª£ng mang ra:</label>
                            <input type="number" id="pizzaL_out" min="0" value="0">
                        </div>
                        <div class="pizza-input-row">
                            <label>S·ªë l∆∞·ª£ng b√°nh b·ªè:</label>
                            <input type="number" id="pizzaL_discard" min="0" value="0">
                        </div>
                    </div>
                    <div class="pizza-size-group">
                        <h5>Size S</h5>
                        <div class="pizza-input-row">
                            <label>Trong m√°y t√≠nh ti·ªÅn:</label>
                            <input type="number" id="pizzaS_system" min="0" value="0">
                        </div>
                        <div class="pizza-input-row">
                            <label>S·ªë l∆∞·ª£ng mang ra:</label>
                            <input type="number" id="pizzaS_out" min="0" value="0">
                        </div>
                        <div class="pizza-input-row">
                            <label>S·ªë l∆∞·ª£ng b√°nh b·ªè:</label>
                            <input type="number" id="pizzaS_discard" min="0" value="0">
                        </div>
                    </div>
                    <button class="btn" onclick="checkPizza()">Ki·ªÉm Tra</button>
                </div>
                <div class="check-result-section">
                    <h4>K·∫øt Qu·∫£ Ki·ªÉm Tra</h4>
                    <div id="checkResult"></div>
                </div>
            </div>
            <button class="btn save-btn" onclick="savePizzaCheck()">L∆∞u Check B√°nh</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://tyuufjwutazjfuiawiul.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5dXVmand1dGF6amZ1aWF3aXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MDk4OTIsImV4cCI6MjA3NjA4NTg5Mn0.8WEsb2tBD6akNA9h9tR9zIAqjkZz0xZYVNbYCx2dEbc';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        
        // Discord Webhook
        const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1387472354149400748/t4uIPrQMAPg1MuUDOm8DW3r-2dDXQMQhdVxJ8QrUPX9igBBwyOOrsxVIdRQDzclI5smh';

        // Login credentials (c·ªë ƒë·ªãnh trong code)
        const CREDENTIALS = {
            'DH': { username: 'DH258', password: '258DH' },
            'NH': { username: 'NH141', password: '141NH' },
            'HXH': { username: 'HXH01', password: '01HXH' },
            'PY': { username: 'BT227', password: '227BT' }
        };

        const STORE_NAMES = {
            'DH': 'DH',
            'NH': 'NH',
            'HXH': 'HXH',
            'PY': 'PY'
        };

        // Inventory categories and items
        const INVENTORY_CATEGORIES = {
             'L√†m b√°nh': [
                        'ƒê·∫ø L',
                        'ƒê·∫ø S',
                        'Ph√¥ Mai L',
                        'Ph√¥ Mai S',
                        'B√≤ pizza (b·ªãch)',
                        'B√≤ m√¨ √ù (b·ªãch)',
                        'G√† pizza (b·ªãch)',
                        'T√¥m (b·ªãch)',
                        'M·ª±c (b·ªãch)',
                        'C√° Ng·ª´ (b·ªãch)',
                        'XXH (b·ªãch)',
                        'XXƒê (b·ªãch)',
                        'Ba R·ªçi (b·ªãch)',
                        'B√≤ s·ªët cay (b·ªãch)',
                        'S·ªët s·ªØa (b·ªãch)',
                        'S·ªët c√† (h≈©)',
                        'S·ªët G√†',
                        'Salami (b·ªãch)',
                        'N·∫•m (b·ªãch)',
                        'B√¥ng C·∫£i Xanh (b·ªãch)',
                        
                    ],

            'M√≥n ƒÉn nh·∫π': [
                'G√† L·∫Øc (b·ªãch)',
                'ƒê√πi G√† (c√°i)',
                        'XX Chi√™n X√π',
                        'Bom Ph√¥ Mai (vi√™n)',
                        'KTC (b·ªãch)',
                        'Tok (b·ªãch)'

            ],    

             'Bao b√¨ ': [
                        'Bao 1 m√≥n (kg)',
                        'Bao pizza l·ªõn (kg)',
                        'Bao c√¢n m√¨ (kg)',
                        'Bao r√°c (kg)',
                        'D√¢y thun (b·ªãch)',
                        'Ly nh·ª±a (l·ªëc)',
                        'H≈© c√° ng·ª´',
                        '·ªêng h√∫t',
                        'B√¨ ƒë·ª±ng ly',
                        'H·ªôp l·ªõn',
                        'H·ªôp nh·ªè'
                        
                    ],

            "N∆∞·ªõc": [
                        'Coca chai',
                        'Coca lon',
                        'N∆∞·ªõc su·ªëi',
                        'Bia Blance',
                        'Bia Quy Nh∆°n',
                        'ƒê√° Me (b·ªãch)',
                        'M·ª©t ƒë√†o (b·ªãch)',
                        'Mi·∫øng ƒë√†o (b·ªãch)',
                        'Tr√† chanh (h·ªôp)',
                        'Tr√† ƒë√†o (h·ªôp)',
                    ],
    
        };

        let currentUser = null;
        let currentStore = null;
        let inventoryData = {};
        let pizzaCheckData = null;

        // Initialize inventory data
        function initInventoryData() {
            inventoryData = {};
            for (let category in INVENTORY_CATEGORIES) {
                INVENTORY_CATEGORIES[category].forEach(item => {
                    inventoryData[item] = 0;
                });
            }
        }

        // Login form handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const store = document.getElementById('storeSelect').value;
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (CREDENTIALS[store] && 
                CREDENTIALS[store].username === username && 
                CREDENTIALS[store].password === password) {
                currentStore = store;
                currentUser = username;
                showApp();
            } else {
                alert('Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!');
            }
        });

        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appScreen').classList.remove('hidden');
            
            const today = new Date().toLocaleDateString('vi-VN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            document.getElementById('storeName').textContent = STORE_NAMES[currentStore];
            document.getElementById('userInfo').textContent = `${today} | Nh√¢n vi√™n: ${currentUser}`;
            
            initInventoryData();
            renderInventory();
            showMainMenu();
        }

        function logout() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
                document.getElementById('appScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('loginForm').reset();
                currentUser = null;
                currentStore = null;
            }
        }

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'block';
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
        }

        function showSection(section) {
            document.getElementById('mainMenu').style.display = 'none';
            document.querySelectorAll('.content-section').forEach(s => {
                s.classList.remove('active');
            });
            document.getElementById(section + 'Section').classList.add('active');
            
            if (section === 'order') {
                renderOrderList();
            }
        }

        function renderInventory() {
            const container = document.getElementById('inventoryList');
            container.innerHTML = '';
            
            for (let category in INVENTORY_CATEGORIES) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-item';
                
                const header = document.createElement('div');
                header.className = 'category-header';
                header.innerHTML = `${category} <span class="arrow">‚ñº</span>`;
                header.onclick = function() {
                    categoryDiv.classList.toggle('active');
                    content.classList.toggle('active');
                };
                
                const content = document.createElement('div');
                content.className = 'category-content';
                
                INVENTORY_CATEGORIES[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'item-input';
                    itemDiv.innerHTML = `
                        <label>${item}</label>
                        <input type="number" min="0" value="${inventoryData[item]}" 
                               onchange="inventoryData['${item}'] = parseInt(this.value) || 0">
                    `;
                    content.appendChild(itemDiv);
                });
                
                categoryDiv.appendChild(header);
                categoryDiv.appendChild(content);
                container.appendChild(categoryDiv);
            }
        }

        function renderOrderList() {
            const container = document.getElementById('orderList');
            container.innerHTML = '';
            
            for (let item in inventoryData) {
                const itemDiv = document.createElement('div');
                const stock = inventoryData[item];
                const isLowStock = (item === 'S·ªët c√† chua') ? false : stock < 3;
                
                itemDiv.className = 'order-item' + (isLowStock ? ' low-stock' : '');
                itemDiv.innerHTML = `
                    <span class="order-item-name">${item}</span>
                    <span class="order-item-stock">T·ªìn: ${stock}</span>
                    <input type="number" min="0" value="0" placeholder="S·ªë l∆∞·ª£ng ƒë·∫∑t">
                `;
                container.appendChild(itemDiv);
            }
        }

        function checkPizza() {
            const pizzaL_system = parseInt(document.getElementById('pizzaL_system').value) || 0;
            const pizzaL_out = parseInt(document.getElementById('pizzaL_out').value) || 0;
            const pizzaL_discard = parseInt(document.getElementById('pizzaL_discard').value) || 0;
            
            const pizzaS_system = parseInt(document.getElementById('pizzaS_system').value) || 0;
            const pizzaS_out = parseInt(document.getElementById('pizzaS_out').value) || 0;
            const pizzaS_discard = parseInt(document.getElementById('pizzaS_discard').value) || 0;

            const pizzaL_expected = pizzaL_out - pizzaL_discard;
            const pizzaS_expected = pizzaS_out - pizzaS_discard;

            const pizzaL_diff = pizzaL_system - pizzaL_expected;
            const pizzaS_diff = pizzaS_system - pizzaS_expected;

            const resultDiv = document.getElementById('checkResult');
            
            pizzaCheckData = {
                sizeL: { system: pizzaL_system, out: pizzaL_out, discard: pizzaL_discard, diff: pizzaL_diff },
                sizeS: { system: pizzaS_system, out: pizzaS_out, discard: pizzaS_discard, diff: pizzaS_diff }
            };

            if (pizzaL_diff === 0 && pizzaS_diff === 0) {
                resultDiv.innerHTML = '<div class="result-message success">‚úì ƒê·ªß b√°nh! S·ªë l∆∞·ª£ng b√°nh kh·ªõp ch√≠nh x√°c.</div>';
            } else {
                let html = '<div class="result-message error">‚úó Kh√¥ng kh·ªõp s·ªë l∆∞·ª£ng b√°nh</div>';
                html += '<div class="shortage-list">';
                if (pizzaL_diff !== 0) {
                    html += `<div class="shortage-item">Size L: ${pizzaL_diff > 0 ? 'Th·ª´a ' + pizzaL_diff : 'Thi·∫øu ' + Math.abs(pizzaL_diff)} b√°nh</div>`;
                }
                if (pizzaS_diff !== 0) {
                    html += `<div class="shortage-item">Size S: ${pizzaS_diff > 0 ? 'Th·ª´a ' + pizzaS_diff : 'Thi·∫øu ' + Math.abs(pizzaS_diff)} b√°nh</div>`;
                }
                html += '</div>';
                resultDiv.innerHTML = html;
            }
        }

        function formatNumberInput(input) {
            input.addEventListener('input', () => {
                let value = input.value.replace(/[^0-9]/g, ''); // b·ªè k√Ω t·ª± kh√¥ng ph·∫£i s·ªë
                if (value) {
                    input.value = parseInt(value).toLocaleString('vi-VN'); // format theo chu·∫©n VN
                } else {
                    input.value = '';
                }
            });
        }

        // G√°n cho t·∫•t c·∫£ c√°c input doanh thu
        ['cashRevenue', 'transferRevenue', 'grabRevenue', 'shopeeRevenue'].forEach(id => {
            const el = document.getElementById(id);
            if (el) formatNumberInput(el);
        });

        // Save functions
        async function saveRevenue() {
            const cash = parseFloat(document.getElementById('cashRevenue').value) || 0;
            const transfer = parseFloat(document.getElementById('transferRevenue').value) || 0;
            const grab = parseFloat(document.getElementById('grabRevenue').value) || 0;
            const shopee = parseFloat(document.getElementById('shopeeRevenue').value) || 0;

            const data = {
                store_id: currentStore,
                username: currentUser,
                date: new Date().toISOString(),
                cash_revenue: cash,
                transfer_revenue: transfer,
                grab_revenue: grab,
                shopee_revenue: shopee,
                total_revenue: cash + transfer + grab + shopee
            };

            try {
                const { error } = await supabase.from('sale_quan').insert([data]);
                if (error) throw error;
                alert('ƒê√£ l∆∞u doanh thu th√†nh c√¥ng!');
                document.querySelectorAll('#revenueSection input').forEach(input => input.value = '');
            } catch (error) {
                console.error('Error:', error);
                alert('C√≥ l·ªói khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }

        async function saveInventory() {
            const data = {
                store_id: currentStore,
                username: currentUser,
                date: new Date().toISOString(),
                inventory: inventoryData
            };

            try {
                const { error } = await supabase.from('ton_quan').insert([data]);
                if (error) throw error;
                alert('ƒê√£ l∆∞u ki·ªÉm h√†ng th√†nh c√¥ng!');
            } catch (error) {
                console.error('Error:', error);
                alert('C√≥ l·ªói khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }


                    async function saveOrder() {
                const orderItems = [];
                const inputs = document.querySelectorAll('#orderList input');
                const items = Object.keys(inventoryData);

                // üßÆ T·∫°o danh s√°ch m√≥n ƒë·∫∑t
                inputs.forEach((input, index) => {
                    const quantity = parseInt(input.value) || 0;
                    if (quantity > 0) {
                        orderItems.push({
                            item: items[index],
                            current_stock: inventoryData[items[index]],
                            order_quantity: quantity
                        });
                    }
                });

                if (orderItems.length === 0) {
                    alert('Vui l√≤ng nh·∫≠p s·ªë l∆∞·ª£ng h√†ng c·∫ßn ƒë·∫∑t!');
                    return;
                }

                // üóÇ Chu·∫©n b·ªã d·ªØ li·ªáu ƒë·ªÉ l∆∞u Supabase
                const data = {
                    store_id: currentStore,
                    username: currentUser,
                    date: new Date().toISOString(),
                    order_items: orderItems
                };

                try {
                    // 1Ô∏è‚É£ L∆∞u v√†o Supabase
                    const { error } = await supabase.from('order_quan').insert([data]);
                    if (error) throw error;

                    // 2Ô∏è‚É£ G·ª≠i th√¥ng b√°o Telegram
                    await sendTelegramNotification(data, orderItems);

                    // 3Ô∏è‚É£ Reset form
                    alert('‚úÖ ƒê√£ l∆∞u ƒë∆°n h√†ng v√† g·ª≠i th√¥ng b√°o th√†nh c√¥ng!');
                    document.querySelectorAll('#orderList input').forEach(input => input.value = '0');

                } catch (error) {
                    console.error('Error:', error);
                    alert('‚ùå C√≥ l·ªói khi l∆∞u d·ªØ li·ªáu ho·∫∑c g·ª≠i th√¥ng b√°o. Vui l√≤ng th·ª≠ l·∫°i!');
                }
            }


            // --- üì® G·ª≠i th√¥ng b√°o Telegram ---
            async function sendTelegramNotification(data, orderItems) {
                const botToken = '8036982528:AAEymf0l1HH47SB10gcd7QwxyugpBLxrvas'; // Token bot
                const chatId = '-4776196182'; // ID nh√≥m ho·∫∑c user

                const dateStr = new Date().toLocaleString('vi-VN', {
                    day: '2-digit', month: '2-digit', year: 'numeric',
                    hour: '2-digit', minute: '2-digit'
                });

                // üîπ T√°ch ri√™ng t√™n h√†ng & s·ªë l∆∞·ª£ng
                const itemNames = orderItems.map(i => `‚Ä¢ ${i.item}`).join('\n');
                const itemQtys = orderItems.map(i => `‚Ä¢ ${i.order_quantity}`).join('\n');

                // üîπ G·ªôp t√™n h√†ng v√† s·ªë l∆∞·ª£ng tr√™n c√πng 1 d√≤ng
                    const itemsList = orderItems
                    .map(i => `${i.item.padEnd(20, ' ')} - ${i.order_quantity}`)
                    .join('\n');

                    const message =
                    `üõí *ƒê∆†N ƒê·∫∂T H√ÄNG M·ªöI*

                    üè™ *Qu√°n:* ${STORE_NAMES[data.store_id] || 'Kh√¥ng x√°c ƒë·ªãnh'}
                    üë§ *Ng∆∞·ªùi ƒë·∫∑t:* ${data.username}
                    üìÖ *Th·ªùi gian:* ${dateStr}

                    üì¶ *Danh s√°ch h√†ng ƒë·∫∑t:*
                    \`\`\`
                    ${itemsList}
                    \`\`\`

_H·ªá th·ªëng qu·∫£n l√Ω Pizza_`;

                const url = `https://api.telegram.org/bot${botToken}/sendMessage`;

                const payload = {
                    chat_id: chatId,
                    text: message,
                    parse_mode: "Markdown"
                };

                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (!result.ok) throw new Error(result.description);
            }


        async function savePizzaCheck() {
            if (!pizzaCheckData) {
                alert('Vui l√≤ng ki·ªÉm tra b√°nh tr∆∞·ªõc khi l∆∞u!');
                return;
            }

            const data = {
                store_id: currentStore,
                username: currentUser,
                date: new Date().toISOString(),
                pizza_check: pizzaCheckData
            };

            try {
                const { error } = await supabase.from('pizza_check').insert([data]);
                if (error) throw error;
                alert('ƒê√£ l∆∞u check b√°nh th√†nh c√¥ng!');
            } catch (error) {
                console.error('Error:', error);
                alert('C√≥ l·ªói khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!');
            }
        }
    
    </script>
</body>
</html>
